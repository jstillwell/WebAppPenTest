using System;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Collections.Generic;

namespace WebAppPenTest.Proxy.Test {
    [TestClass]
    public class PacketTests {
        [TestMethod]
        public void Packet_Insert_Success() {
            //arrange
            var domPacket = new Domain.Packet();
            var model = new Common.Models.Packet {
                Destination = "Destination",
                Source = "Source",
                IsIncoming = true,
                Protocol = System.Net.Sockets.ProtocolType.Tcp,
                Timestamp = DateTime.Now,
                Url = "http://www.google.com"
            };

            model.Headers = new List<Common.Models.Header> {
                new Common.Models.Header {
                    PacketId = model.Id,
                    Key = "user-agent",
                    Value = "johns test"
                }
            };

            //act 
            domPacket.Insert(model);

            //assert
            Assert.AreNotEqual(0, model.Id);
        }
        [TestMethod]
        public void Packet_Insert_MultipleHeaders_Success() {
            //arrange
            var domPacket = new Domain.Packet();
            var model = new Common.Models.Packet {
                Destination = "Destination",
                Source = "Source",
                IsIncoming = true,
                Protocol = System.Net.Sockets.ProtocolType.Tcp,
                Timestamp = DateTime.Now,
                Url = "http://www.google.com"
            };

            model.Headers = new List<Common.Models.Header> {
                new Common.Models.Header {
                    PacketId = model.Id,
                    Key = "user-agent",
                    Value = "johns test"
                },
                new Common.Models.Header {
                    PacketId = model.Id,
                    Key = "content-type",
                    Value = "unit test"
                }
            };

            //act 
            domPacket.Insert(model);

            //assert
            Assert.AreNotEqual(0, model.Id);
        }
        [TestMethod]
        public void Packet_Get_Success() {
            //arrange
            var domPacket = new Domain.Packet();
            var id = 1;

            //act 
            var model = domPacket.Get(id);

            //assert
            Assert.AreNotEqual(0, model.Id);
        }
        [TestMethod]
        public void Packet_GetList_Success() {
            //arrange
            var domPacket = new Domain.Packet();

            //act 
            var packets = domPacket.GetList(DateTime.Parse("2016-01-01"), DateTime.Now);

            //assert
            Assert.AreNotEqual(0, packets[0].Id);
        }
    }
}
